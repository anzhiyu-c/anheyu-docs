---
title: 支付配置指南
description: 详细了解如何配置易支付、虎皮椒支付（及原生支付宝/微信支付）
---

本文档详细说明如何在 AnheyuPro 系统中配置支付通道。

<Callout type="info" title="支付方式与支付通道">
  - **支付方式（前台展示）**：支付宝、微信 - **支付通道（后台配置）**：支持易支付、虎皮椒
  V3（聚合通道），也支持原生支付宝当面付/微信支付 V3 - **注意**：原生通道与聚合通道不可同时启用（需二选一）
</Callout>

## 支付宝支付配置

### 前置条件

- 支付宝企业账号，已完成实名认证
- 已开通"当面付"产品
- 已创建应用（网页/移动应用）

### 获取配置参数

1. 登录 [支付宝开放平台](https://open.alipay.com/)
2. 在应用详情页获取 **APPID**
3. 使用 [密钥生成工具](https://opendocs.alipay.com/common/02kipl) 生成密钥对
4. 将应用公钥上传到支付宝，获取 **支付宝公钥**

### 配置说明

将获取的参数填入系统的 **支付宝配置** 表单：

| 配置项         | 说明                          | 示例               |
| -------------- | ----------------------------- | ------------------ |
| **应用 ID**    | 支付宝应用的 APPID            | `2021001234567890` |
| **应用私钥**   | 应用私钥（纯密钥或 PEM 格式） | 密钥生成工具生成   |
| **支付宝公钥** | 从支付宝平台获取的公钥        | 上传公钥后获取     |

<Callout type="warn" title="注意">
  应用私钥务必妥善保管。支付宝公钥要从支付宝平台复制，不是自己生成的应用公钥。
</Callout>

---

## 微信支付配置

### 前置条件

- 已注册微信支付商户号，完成企业认证
- 已开通 **Native 支付**（扫码支付）

### 获取配置参数

1. 登录 [微信支付商户平台](https://pay.weixin.qq.com/)
2. 获取 **商户号**（账户中心 → 个人信息）
3. 获取关联的 **APPID**（产品中心 → AppID 账号管理）
4. 设置 **API v3 密钥**（账户中心 → API 安全，32 位字符串）
5. 申请 **API 证书**，获取私钥文件 `apiclient_key.pem` 和证书序列号

### 配置说明

| 配置项          | 说明                            | 示例                 |
| --------------- | ------------------------------- | -------------------- |
| **应用 ID**     | 微信 APPID（公众号/小程序/APP） | `wx1234567890abcdef` |
| **商户号**      | 微信支付商户号                  | `1234567890`         |
| **商户序列号**  | API 证书序列号（40 位 16 进制） | `1A2B3C...`          |
| **API v3 密钥** | APIv3 密钥（32 位字符串）       | `abcd1234...`        |
| **商户私钥**    | API 证书私钥（完整 PEM 格式）   | `apiclient_key.pem`  |

<Callout type="warn" title="注意">
  商户私钥必须保持完整的 PEM 格式。API v3 密钥设置后不可查看，请妥善保管。
</Callout>

---

## 聚合支付配置（易支付 / 虎皮椒）

如果你不想直接对接支付宝/微信的原生接口，推荐使用聚合支付通道：

- **易支付（EPAY）**：通常可提供支付宝/微信等多种通道的聚合能力
- **虎皮椒 V3（HUPIJIAO）**：聚合通道，默认网关 `https://api.xunhupay.com`

<Callout type="warn" title="启用规则">
  - 启用聚合支付（易支付/虎皮椒）后，将无法同时启用原生支付宝/微信支付 - 前台仍然只展示 **支付宝/微信**
  两种方式，系统会根据后台启用的通道自动选择实际走的支付通道
</Callout>

### 易支付（EPAY）配置

在系统后台 **系统设置** → **支付配置** → **易支付** 中填写：

| 配置项           | 说明                                 | 示例                                  |
| ---------------- | ------------------------------------ | ------------------------------------- |
| **商户号**       | 易支付商户号（`mch_id`/`pid`）       | `10001`                               |
| **商户密钥**     | 易支付商户密钥（`key`）              | `xxxxxxxxxxxxxxxxxxxx`                |
| **支付网关**     | 易支付网关地址（`gateway`）          | `https://pay.example.com`             |
| **同步跳转地址** | 支付完成后的同步跳转（`return_url`） | `https://your-domain.com/pay/success` |

异步回调地址（`notify_url`）由系统自动生成：

`https://your-domain.com/api/pro/payment/callback/epay`

### 虎皮椒 V3（HUPIJIAO）配置

在系统后台 **系统设置** → **支付配置** → **虎皮椒 V3** 中填写：

| 配置项           | 说明                                 | 示例                                  |
| ---------------- | ------------------------------------ | ------------------------------------- |
| **应用 ID**      | 虎皮椒应用 ID（`app_id`）            | `201234`                              |
| **应用密钥**     | 虎皮椒应用密钥（`app_secret`）       | `xxxxxxxxxxxxxxxxxxxx`                |
| **支付网关**     | 网关地址（`gateway`，可选）          | `https://api.xunhupay.com`            |
| **同步跳转地址** | 支付完成后的同步跳转（`return_url`） | `https://your-domain.com/pay/success` |

异步回调地址（`notify_url`）由系统自动生成：

`https://your-domain.com/api/pro/payment/callback/hupijiao`

---

## 系统配置

1. 进入 **系统设置** → **支付配置**
2. 填写对应支付通道的配置参数
3. 点击 **保存配置** 和 **测试连接**
4. 确保 **站点 URL**（基础设置）配置正确，系统会自动生成回调地址

配置完成后，建议创建小额测试订单验证支付流程。

---

## 常见问题

| 问题                     | 解决方案                                 |
| ------------------------ | ---------------------------------------- |
| 签名验证失败             | 检查私钥和公钥是否配对，确认密钥格式正确 |
| 证书序列号错误           | 确认序列号为 40 位 16 进制，无多余空格   |
| 回调地址无法访问         | 确保使用 HTTPS，防火墙开放 443 端口      |
| 支付成功但订单状态未更新 | 检查站点 URL 配置和回调地址              |
| API v3 密钥忘记          | 只能在商户平台重新设置                   |

## 相关链接

- [支付宝开放平台](https://open.alipay.com/) / [支付宝文档](https://opendocs.alipay.com/)
- [微信支付商户平台](https://pay.weixin.qq.com/) / [微信支付文档](https://pay.weixin.qq.com/wiki/doc/apiv3/index.shtml)
