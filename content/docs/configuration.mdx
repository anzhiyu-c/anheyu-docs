---
title: 配置指南
description: 了解 Anheyu 的详细配置选项
---

## ip 信息获取

安和鱼系统中的 ip 地址来源于 青桔 API

系统默认配置了 API 地址以及 TOKEN，但是不保证可用性，你可以登录后台在

`系统设置` -> `文章配置` 里面配置 `IP 属地查询 API 地址` 以及 `IP属地查询 API Token`

可以到 [https://api.nsmao.net](https://api.nsmao.net) 注册账户并且获取 Token 后填写进来(强烈建议)

## 邮件配置

你可以登录后台在 `系统设置` -> `邮件配置` 里面配置 SMTP 相关配置

## 文件管理

系统存在两个默认文件夹，不支持删除。

`comment_image`: 评论图片
`article_image`: 文章图片

## 缩略图

安和鱼系统支持为多种类型的文件生成缩略图，包括图像、视频、音频封面等。缩略图功能可以显著提升用户浏览文件的体验。

### 生成逻辑

#### 何时生成

安和鱼系统不会在文件上传后立即尝试为其生成缩略图，而是在用户尝试查看缩略图时按需生成。对于每个文件，其缩略图的状态可分为以下几种：

- **未知状态** - 新文件上传后的默认状态。在文件列表查看此文件时，系统会尝试加载或生成缩略图。
  - 如果已有缩略图文件，直接使用该缩略图
  - 如果缩略图不存在，则尝试生成缩略图
- **缩略图不存在** - 在文件列表查看此文件时，系统不会展示缩略图

#### 状态重置

在下列情况下，文件的缩略图状态会被重设为**未知状态**：

- 文件被重命名且文件的扩展名发生变化
- 文件内容被更新或替换

在下列情况下，文件的缩略图状态会被重设为**缩略图不存在**：

- 没有可用的缩略图生成器
- 缩略图生成器生成缩略图失败

### 支持的文件类型

安和鱼系统内置了多种缩略图生成器，支持以下文件类型：

| 文件类型 | 支持格式                  | 说明                     |
| -------- | ------------------------- | ------------------------ |
| 图片     | PNG、JPEG、GIF、WebP、BMP | 使用内置图像处理引擎     |
| 视频     | MP4、AVI、MOV、MKV、WebM  | 提取视频关键帧作为缩略图 |
| 音频     | MP3、MP4、M4A、FLAC、OGG  | 提取专辑封面作为缩略图   |

### 缩略图管理

#### 手动重新生成

当缩略图显示异常或需要更新时，可以手动触发缩略图重新生成：

1. 在文件列表中找到目标文件
2. 右键点击文件，选择"重新生成缩略图"
3. 系统将异步重新生成该文件的缩略图

#### 批量重新生成

对于包含大量文件的目录，可以批量重新生成缩略图：

1. 进入目标目录
2. 点击右上角的"更多操作"按钮
3. 选择"批量重新生成缩略图"
4. 系统将在后台异步处理该目录下所有文件的缩略图

### 访问控制

缩略图的访问遵循以下安全机制：

- **权限继承** - 缩略图的访问权限与原文件相同
- **访问凭证** - 系统为缩略图生成临时访问凭证，确保安全性
- **过期机制** - 访问凭证具有时效性，过期后需要重新获取

### 存储策略

不同的存储策略对缩略图的支持程度不同：

| 存储策略 | 缩略图支持  | 说明                         |
| -------- | ----------- | ---------------------------- |
| 本机存储 | ✅ 完全支持 | 支持所有类型的缩略图生成     |
| OneDrive | ⚠️ 有限支持 | 主要依赖 OneDrive 原生缩略图 |

<Callout type="warn" title="注意事项">
  对于标记为"有限支持"的存储策略，建议在存储策略设置中开启"缩略图代理生成"功能，以获得更完整的缩略图支持。
</Callout>

### 性能优化

#### 缩略图缓存

- 生成的缩略图会被缓存，避免重复生成
- 缓存策略遵循 LRU（最近最少使用）算法
- 当存储空间不足时，系统会自动清理旧的缩略图缓存

#### 异步处理

- 缩略图生成采用异步处理机制，不会阻塞用户操作
- 生成过程中会显示加载状态，完成后自动更新显示
- 对于大文件或复杂格式，生成时间可能较长

### 故障排除

#### 缩略图无法显示

1. 检查文件格式是否受支持
2. 确认文件未损坏
3. 尝试手动重新生成缩略图
4. 检查存储策略配置

#### 缩略图生成缓慢

1. 检查服务器资源使用情况
2. 考虑调整缩略图质量设置
3. 检查网络连接状况（对于远程存储）

#### 批量生成任务失败

1. 查看任务中心的错误信息
2. 检查目录权限设置
3. 确认存储空间充足
4. 联系系统管理员查看详细日志

如果遇到其他问题，建议查看系统日志或联系技术支持。
